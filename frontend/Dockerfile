FROM node:20-alpine AS builder
WORKDIR /app

# ‚úÖ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
COPY package.json package-lock.json ./
RUN npm install

# ‚úÖ –ö–æ–ø–∏—Ä—É–µ–º –∫–æ–¥ –∏ –±–∏–ª–¥–∏–º
COPY . .
RUN npm run build

# ========== –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞ –¥–ª—è Nginx ==========
FROM nginx:latest AS serve

# ‚úÖ –ö–æ–ø–∏—Ä—É–µ–º –Ω–∞—à `nginx.conf` –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Nginx
COPY --from=builder /app/nginx.conf /etc/nginx/conf.d/default.conf  
RUN echo "üìÇ –§–∞–π–ª—ã –≤ dist/:" && ls -la /etc/nginx/conf.d
RUN echo "üìÇ –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–∞ nginx/:" && cat /etc/nginx/conf.d/default.conf
# ‚úÖ –ö–æ–ø–∏—Ä—É–µ–º —Å–æ–±—Ä–∞–Ω–Ω—ã–π —Ñ—Ä–æ–Ω—Ç –≤ Nginx
COPY --from=builder /app/dist /usr/share/nginx/html

EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]